<div class="auth-container">
  <div class="auth-wrapper">
    <!-- Header -->
    <div class="auth-header">
      <div class="logo-container">
        <div class="logo-circle">
          <app-icon category="delivery" name="package" size="32px"></app-icon>
        </div>
      </div>
      <h1>Soluciones</h1>
      <p>Tu plataforma de envíos confiable</p>
    </div>

    <!-- Auth Forms -->
    <div class="tabs-container">
      <div class="tab-content">
        <div class="card">
          <div class="card-header">
            <h2>
              {{ authTab === 'login' ? 'Iniciar Sesión' :
                 authTab === 'register' ? 'Crear Cuenta' :
                 authTab === 'forgot' ? 'Recuperar Contraseña' :
                 'Confirmar Correo' }}
            </h2>
            <p>
              {{ authTab === 'login'
                ? 'Accede para rastrear tus envíos y gestionar tus paquetes'
                : authTab === 'register'
                ? 'Regístrate como cliente para comenzar a enviar paquetes'
                : authTab === 'forgot'
                ? (forgotStep === 'email' ? 'Ingresa tu correo para recibir un código de recuperación' : 'Ingresa el código y tu nueva contraseña')
                : 'Ingresa el código que enviamos a tu correo electrónico'
              }}
            </p>
          </div>
          <div class="card-content">
            <!-- ========================================
                 LOGIN FORM
                 ======================================== -->
            <form *ngIf="authTab === 'login'" (ngSubmit)="handleLogin($event)" class="form">
              <div class="form-group">
                <label for="login-email">Correo electrónico</label>
                <input 
                  id="login-email"
                  type="email" 
                  [(ngModel)]="email" 
                  name="email" 
                  required 
                  [disabled]="isLoading"
                  [class.input-error]="emailError"
                  autocomplete="email"
                  placeholder="usuario@ejemplo.com"
                />
                <span *ngIf="emailError" class="error-message">{{ emailError }}</span>
              </div>

              <div class="form-group">
                <label for="login-password">Contraseña</label>
                <input 
                  id="login-password"
                  type="password" 
                  [(ngModel)]="password" 
                  name="password" 
                  required 
                  [disabled]="isLoading"
                  [class.input-error]="passwordError"
                  autocomplete="current-password"
                  placeholder="••••••••"
                />
                <span *ngIf="passwordError" class="error-message">{{ passwordError }}</span>
              </div>

              <button type="submit" class="btn btn-primary" [disabled]="isLoading">
                <span *ngIf="!isLoading">Iniciar sesión</span>
                <span *ngIf="isLoading" class="loading-content">
                  <span class="spinner"></span>
                  Iniciando sesión...
                </span>
              </button>

              <div class="forgot-password-link">
                <button
                  type="button"
                  (click)="switchToForgotPassword()"
                  class="link-button"
                  [disabled]="isLoading">
                  ¿Olvidaste tu contraseña?
                </button>
              </div>

              <p class="form-footer">
                ¿No tienes cuenta?
                <button
                  type="button"
                  (click)="switchToRegister()"
                  class="link-button"
                  [disabled]="isLoading">
                  Regístrate aquí
                </button>
              </p>
            </form>

            <!-- ========================================
                 REGISTER FORM
                 ======================================== -->
            <form *ngIf="authTab === 'register'" (ngSubmit)="handleRegister($event)" class="form">
              <div class="form-group">
                <label for="reg-fullname">Nombre completo *</label>
                <input
                  id="reg-fullname"
                  type="text"
                  placeholder="Juan Pérez"
                  [(ngModel)]="regFullName"
                  name="regFullName"
                  required
                  [disabled]="isLoading"
                  [class.input-error]="regFullNameError"
                  autocomplete="name"
                />
                <span *ngIf="regFullNameError" class="error-message">{{ regFullNameError }}</span>
              </div>

              <div class="form-group">
                <label for="reg-email">Correo electrónico *</label>
                <input
                  id="reg-email"
                  type="email"
                  placeholder="usuario@ejemplo.com"
                  [(ngModel)]="regEmail"
                  name="regEmail"
                  required
                  [disabled]="isLoading"
                  [class.input-error]="regEmailError"
                  autocomplete="email"
                />
                <span *ngIf="regEmailError" class="error-message">{{ regEmailError }}</span>
              </div>

              <div class="form-group">
                <label for="reg-phone">Teléfono</label>
                <input
                  id="reg-phone"
                  type="tel"
                  placeholder="+57 300 123 4567"
                  [(ngModel)]="regPhone"
                  name="regPhone"
                  [disabled]="isLoading"
                  [class.input-error]="regPhoneError"
                  autocomplete="tel"
                />
                <span *ngIf="regPhoneError" class="error-message">{{ regPhoneError }}</span>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="reg-type-doc">Tipo de documento</label>
                  <select 
                    id="reg-type-doc"
                    [(ngModel)]="regTypeDocument"
                    name="regTypeDocument"
                    [disabled]="isLoading"
                    [class.input-error]="regTypeDocumentError">
                    <option value="">Seleccionar</option>
                    <option value="CC">Cédula de Ciudadanía</option>
                    <option value="CE">Cédula de Extranjería</option>
                    <option value="NIT">NIT</option>
                    <option value="PP">Pasaporte</option>
                  </select>
                  <span *ngIf="regTypeDocumentError" class="error-message">{{ regTypeDocumentError }}</span>
                </div>

                <div class="form-group">
                  <label for="reg-number-doc">Número de documento</label>
                  <input
                    id="reg-number-doc"
                    type="text"
                    placeholder="123456789"
                    [(ngModel)]="regNumberDocument"
                    name="regNumberDocument"
                    [disabled]="isLoading"
                    [class.input-error]="regNumberDocumentError"
                  />
                  <span *ngIf="regNumberDocumentError" class="error-message">{{ regNumberDocumentError }}</span>
                </div>
              </div>

              <div class="form-group">
                <label for="reg-password">Contraseña *</label>
                <input
                  id="reg-password"
                  type="password"
                  placeholder="••••••••"
                  [(ngModel)]="regPassword"
                  name="regPassword"
                  required
                  [disabled]="isLoading"
                  [class.input-error]="regPasswordError"
                  autocomplete="new-password"
                />
                <span *ngIf="regPasswordError" class="error-message">{{ regPasswordError }}</span>
                <small class="input-hint">Mínimo 8 caracteres, incluye mayúsculas, minúsculas, números y caracteres especiales</small>
              </div>

              <button type="submit" class="btn btn-primary" [disabled]="isLoading">
                <span *ngIf="!isLoading">Crear Cuenta</span>
                <span *ngIf="isLoading" class="loading-content">
                  <span class="spinner"></span>
                  Creando cuenta...
                </span>
              </button>

              <p class="form-footer">
                ¿Ya tienes cuenta?
                <button 
                  type="button" 
                  (click)="switchToLogin()" 
                  class="link-button"
                  [disabled]="isLoading">
                  Inicia sesión
                </button>
              </p>
            </form>

            <!-- ========================================
                 FORGOT PASSWORD FORM
                 ======================================== -->
            <!-- Step 1: Email -->
            <form *ngIf="authTab === 'forgot' && forgotStep === 'email'" (ngSubmit)="handleForgotSendCode($event)" class="form">
              <div class="form-group">
                <label for="forgot-email">Correo electrónico</label>
                <input
                  id="forgot-email"
                  type="email"
                  [(ngModel)]="forgotEmail"
                  name="forgotEmail"
                  required
                  [disabled]="isLoading"
                  [class.input-error]="forgotEmailError"
                  autocomplete="email"
                  placeholder="usuario@ejemplo.com"
                />
                <span *ngIf="forgotEmailError" class="error-message">{{ forgotEmailError }}</span>
              </div>

              <button type="submit" class="btn btn-primary" [disabled]="isLoading">
                <span *ngIf="!isLoading">Enviar código de recuperación</span>
                <span *ngIf="isLoading" class="loading-content">
                  <span class="spinner"></span>
                  Enviando código...
                </span>
              </button>

              <p class="form-footer">
                <button
                  type="button"
                  (click)="switchToLogin()"
                  class="link-button"
                  [disabled]="isLoading">
                  Volver al inicio de sesión
                </button>
              </p>
            </form>

            <!-- Step 2: Code + New Password -->
            <form *ngIf="authTab === 'forgot' && forgotStep === 'confirm'" (ngSubmit)="handleForgotConfirm($event)" class="form">
              <div class="confirm-info">
                <div class="info-box">
                  <app-icon category="communication" name="mail" size="20px"></app-icon>
                  <p>Código enviado a: <strong>{{ forgotEmail }}</strong></p>
                </div>
              </div>

              <div class="form-group">
                <label for="forgot-code">Código de verificación</label>
                <input
                  id="forgot-code"
                  type="text"
                  [(ngModel)]="forgotCode"
                  name="forgotCode"
                  required
                  maxlength="6"
                  [disabled]="isLoading"
                  [class.input-error]="forgotCodeError"
                  autocomplete="one-time-code"
                  placeholder="123456"
                />
                <span *ngIf="forgotCodeError" class="error-message">{{ forgotCodeError }}</span>
              </div>

              <div class="form-group">
                <label for="forgot-new-password">Nueva contraseña</label>
                <input
                  id="forgot-new-password"
                  type="password"
                  [(ngModel)]="forgotNewPassword"
                  name="forgotNewPassword"
                  required
                  [disabled]="isLoading"
                  [class.input-error]="forgotNewPasswordError"
                  autocomplete="new-password"
                  placeholder="••••••••"
                />
                <span *ngIf="forgotNewPasswordError" class="error-message">{{ forgotNewPasswordError }}</span>
                <small class="input-hint">Mínimo 8 caracteres, incluye mayúsculas, minúsculas, números y caracteres especiales</small>
              </div>

              <div class="form-group">
                <label for="forgot-confirm-password">Confirmar contraseña</label>
                <input
                  id="forgot-confirm-password"
                  type="password"
                  [(ngModel)]="forgotConfirmPassword"
                  name="forgotConfirmPassword"
                  required
                  [disabled]="isLoading"
                  [class.input-error]="forgotConfirmPasswordError"
                  autocomplete="new-password"
                  placeholder="••••••••"
                />
                <span *ngIf="forgotConfirmPasswordError" class="error-message">{{ forgotConfirmPasswordError }}</span>
              </div>

              <button type="submit" class="btn btn-primary" [disabled]="isLoading">
                <span *ngIf="!isLoading">Cambiar Contraseña</span>
                <span *ngIf="isLoading" class="loading-content">
                  <span class="spinner"></span>
                  Cambiando contraseña...
                </span>
              </button>

              <p class="form-footer">
                <button
                  type="button"
                  (click)="switchToLogin()"
                  class="link-button"
                  [disabled]="isLoading">
                  Volver al inicio de sesión
                </button>
              </p>
            </form>

            <!-- ========================================
                 CONFIRM EMAIL FORM
                 ======================================== -->
            <form *ngIf="authTab === 'confirm'" (ngSubmit)="handleConfirmEmail($event)" class="form">
              <div class="confirm-info">
                <div class="info-box">
                  <app-icon category="communication" name="mail" size="20px"></app-icon>
                  <p>Código enviado a: <strong>{{ confirmEmail }}</strong></p>
                </div>
              </div>

              <div class="form-group">
                <label for="confirm-code">Código de confirmación</label>
                <input
                  id="confirm-code"
                  type="text"
                  [(ngModel)]="confirmCode"
                  name="confirmCode"
                  required
                  maxlength="6"
                  [disabled]="isLoading"
                  [class.input-error]="confirmCodeError"
                  autocomplete="one-time-code"
                />
                <span *ngIf="confirmCodeError" class="error-message">{{ confirmCodeError }}</span>
              </div>

              <button type="submit" class="btn btn-primary" [disabled]="isLoading">
                <span *ngIf="!isLoading">Confirmar Correo</span>
                <span *ngIf="isLoading" class="loading-content">
                  <span class="spinner"></span>
                  Confirmando...
                </span>
              </button>

              <div class="resend-section">
                <p>¿No recibiste el código?</p>
                <button 
                  type="button" 
                  (click)="handleResendCode()" 
                  class="btn-link"
                  [disabled]="isResendingCode || isLoading">
                  <span *ngIf="!isResendingCode">Reenviar código</span>
                  <span *ngIf="isResendingCode" class="loading-content">
                    <span class="spinner-small"></span>
                    Reenviando...
                  </span>
                </button>
              </div>

              <p class="form-footer">
                <button 
                  type="button" 
                  (click)="switchToLogin()" 
                  class="link-button"
                  [disabled]="isLoading">
                  Volver al inicio de sesión
                </button>
              </p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Back to Home -->
    <div class="back-link">
      <button class="btn-link" (click)="goHome()" [disabled]="isLoading">
        <app-icon category="navigation" name="arrow-left" size="16px"></app-icon>
        Volver al inicio
      </button>
    </div>
  </div>
</div>