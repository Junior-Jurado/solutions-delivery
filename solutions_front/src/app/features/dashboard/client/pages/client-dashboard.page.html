<div class="client-dashboard">
  <!-- Header Component -->
  <app-dashboard-header
    [currentUser]="currentUser"
    [isMobile]="isMobile"
    (logout)="logout()">
  </app-dashboard-header>

  <!-- Main Content -->
  <main class="dashboard-main">
    <div class="dashboard-container">
      <!-- Navigation Tabs -->
      <nav class="dashboard-tabs">
        <button 
          class="tab-button"
          [class.active]="activeTab === 'tracking'"
          (click)="setActiveTab('tracking')">
          <app-icon category="common" name="search" size="20px"></app-icon>
          <span>Rastrear Guía</span>
        </button>
        
        <button 
          class="tab-button"
          [class.active]="activeTab === 'my-guides'"
          (click)="setActiveTab('my-guides')">
          <app-icon category="common" name="clipboard-list" size="20px"></app-icon>
          <span>Mis Guías</span>
        </button>
        
        <button 
          class="tab-button"
          [class.active]="activeTab === 'history'"
          (click)="setActiveTab('history')">
          <app-icon category="common" name="clock" size="20px"></app-icon>
          <span>Histórico</span>
        </button>

        <button 
          class="tab-button"
          [class.active]="activeTab === 'quote'"
          (click)="setActiveTab('quote')">
          <app-icon category="common" name="calculator" size="20px"></app-icon>
          <span>Cotizar</span>
        </button>
        
        <button 
          class="tab-button"
          [class.active]="activeTab === 'create'"
          (click)="setActiveTab('create')">
          <app-icon category="common" name="plus-circle" size="20px"></app-icon>
          <span>Crear Guía</span>
        </button>
      </nav>

      <!-- Tab Content -->
      <div class="tab-content">
        <!-- TRACKING TAB -->
        <div class="tab-panel" *ngIf="activeTab === 'tracking'">
          <app-tracking
            [isTracking]="isTracking"
            [trackingError]="trackingError"
            [trackingResult]="trackingResult"
            (track)="trackGuide($event)"
            (clear)="clearTracking()"
            (viewDetails)="viewGuideDetail($event)">
          </app-tracking>
        </div>

        <!-- MY GUIDES TAB -->
        <div class="tab-panel" *ngIf="activeTab === 'my-guides'">
          <app-my-guides
            [guides]="myGuides"
            [loading]="loadingMyGuides"
            (refresh)="refreshMyGuides()"
            (viewDetails)="viewGuideDetail($event)"
            (downloadPDF)="downloadGuidePDF($event)"
            (createGuide)="setActiveTab('create')">
          </app-my-guides>
        </div>

        <!-- HISTORY TAB -->
        <div class="tab-panel" *ngIf="activeTab === 'history'">
          <app-history
            [guides]="guidesHistory"
            [loading]="loadingHistory"
            (viewDetails)="viewGuideDetail($event)"
            (downloadPDF)="downloadGuidePDF($event)">
          </app-history>
        </div>

        <!-- QUOTE TAB -->
        <div class="tab-panel" *ngIf="activeTab === 'quote'">
          <app-quote
            [quoteData]="quoteData"
            [result]="quoteResult"
            (calculate)="calculateQuote($event)"
            (reset)="resetQuote()"
            (proceedToCreate)="proceedToCreateGuide()">
          </app-quote>
        </div>

        <!-- CREATE GUIDE TAB -->
        <div class="tab-panel" *ngIf="activeTab === 'create'">
          <div class="create-section">
            <div class="section-header">
              <h2>Crear Nueva Guía</h2>
              <p>Complete el formulario para generar una guía de envío</p>
            </div>

            <app-guide-form
              [currentUserId]="userId"
              (formSubmit)="onGuideFormSubmit($event)">
            </app-guide-form>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Guide Preview Modal -->
  <app-guide-preview-modal
    [isOpen]="showGuidePreview"
    [guideData]="guidePreviewData"
    [isCreating]="isCreatingGuide"
    title="Confirmar Creación de Guía"
    warningMessage="Una vez creada, la guía no se puede cancelar. Verifique la información antes de continuar."
    (confirm)="confirmGuideCreation()"
    (cancel)="cancelGuideCreation()"
    (closeModal)="cancelGuideCreation()">
  </app-guide-preview-modal>

  <!-- Guide Details Modal -->
  <app-guide-details-modal
    [guide]="selectedGuide"
    [isOpen]="showDetailsModal"
    (closeModal)="closeDetailsModal()"
    (downloadPDFEvent)="downloadGuidePDF($event)">
  </app-guide-details-modal>

  <!-- Footer Component -->
  <app-dashboard-footer></app-dashboard-footer>
</div>