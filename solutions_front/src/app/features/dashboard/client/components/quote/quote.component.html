<div class="quote-section">
  <div class="section-header">
    <h2>Cotizar Envío</h2>
    <p class="subtitle">Calcula el precio de tu envío antes de crear la guía</p>
  </div>

  <div class="quote-layout">
    <!-- Columna Izquierda: Formulario -->
    <div class="quote-form-card">
      <div class="quote-card-header">
        <app-icon category="common" name="box" size="24px"></app-icon>
        <h3>Información del Paquete</h3>
      </div>

      <form class="quote-form" (ngSubmit)="onCalculate()">
        <!-- Fila 1: Tipo de servicio, Peso, Valor declarado -->
        <div class="quote-form-row three-cols">
          <div class="quote-form-group">
            <label for="quoteServiceType">
              <app-icon category="common" name="tag" size="16px"></app-icon>
              Tipo de servicio *
            </label>
            <select 
              id="quoteServiceType"
              [(ngModel)]="quoteData.serviceType"
              name="serviceType"
              required>
              <option value="">Seleccionar</option>
              <option value="Contado">Contado</option>
              <option value="Contra Entrega">Contra Entrega</option>
              <option value="Crédito">Crédito</option>
            </select>
          </div>

          <div class="quote-form-group">
            <label for="quoteWeight">
              <app-icon category="common" name="weight" size="16px"></app-icon>
              Peso (kg) *
            </label>
            <input 
              id="quoteWeight"
              type="number" 
              [(ngModel)]="quoteData.weight"
              name="weight"
              placeholder="1.5"
              min="0.1"
              step="0.1"
              required>
          </div>

          <div class="quote-form-group">
            <label for="quoteDeclaredValue">
              <app-icon category="common" name="dollar-sign" size="16px"></app-icon>
              Valor declarado *
            </label>
            <input 
              id="quoteDeclaredValue"
              type="number" 
              [(ngModel)]="quoteData.declaredValue"
              name="declaredValue"
              placeholder="50000"
              min="0"
              required>
          </div>
        </div>

        <!-- Fila 2: Dimensiones, Seguro, Piezas -->
        <div class="quote-form-row three-cols">
          <div class="quote-form-group">
            <label for="quoteDimensions">
              <app-icon category="common" name="maximize" size="16px"></app-icon>
              Dimensiones (cm)
            </label>
            <input 
              id="quoteDimensions"
              type="text" 
              [(ngModel)]="quoteData.dimensions"
              name="dimensions"
              placeholder="20x15x10">
            <span class="quote-input-hint">Formato: largo x ancho x alto</span>
          </div>

          <div class="quote-form-group">
            <label for="quoteInsurance">
              <app-icon category="common" name="shield" size="16px"></app-icon>
              Seguro adicional
            </label>
            <select 
              id="quoteInsurance"
              [(ngModel)]="quoteData.insurance"
              name="insurance">
              <option value="no">No</option>
              <option value="básico">Básico</option>
              <option value="completo">Completo</option>
            </select>
          </div>

          <div class="quote-form-group">
            <label for="quotePieces">
              <app-icon category="common" name="layers" size="16px"></app-icon>
              Número de piezas
            </label>
            <input 
              id="quotePieces"
              type="number" 
              [(ngModel)]="quoteData.pieces"
              name="pieces"
              placeholder="1"
              min="1">
          </div>
        </div>

        <!-- Botón Calcular -->
        <button 
          type="submit" 
          class="btn btn-primary btn-quote-calculate"
          [disabled]="!quoteData.weight || quoteData.weight <= 0 || !quoteData.serviceType">
          <app-icon category="common" name="calculator" size="20px"></app-icon>
          <span>Calcular Precio</span>
        </button>
      </form>
    </div>

    <!-- Columna Derecha: Resultado o Placeholder -->
    <div class="quote-result-area">
      <!-- Resultado de la cotización -->
      <div class="quote-result-card" *ngIf="result !== null">
        <div class="quote-card-header success">
          <app-icon category="common" name="check-circle" size="24px"></app-icon>
          <h3>Resultado de la Cotización</h3>
        </div>

        <div class="quote-result-body">
          <!-- Precio Total -->
          <div class="quote-price-display">
            <span class="quote-price-label">Precio Total del Envío</span>
            <span class="quote-price-amount">\${{ formatPrice(result) }}</span>
          </div>

          <!-- Desglose -->
          <div class="quote-breakdown">
            <h4>Desglose del precio:</h4>
            
            <div class="quote-breakdown-row">
              <span class="quote-breakdown-label">Tarifa base:</span>
              <span class="quote-breakdown-value">\${{ formatPrice(15000) }}</span>
            </div>
            
            <div class="quote-breakdown-row">
              <span class="quote-breakdown-label">Peso ({{ quoteData.weight }} kg x \$3,000):</span>
              <span class="quote-breakdown-value">\${{ formatPrice(quoteData.weight * 3000) }}</span>
            </div>

            <div class="quote-breakdown-divider"></div>
            
            <div class="quote-breakdown-row total">
              <span class="quote-breakdown-label">Total:</span>
              <span class="quote-breakdown-value">\${{ formatPrice(result) }}</span>
            </div>
          </div>

          <!-- Resumen -->
          <div class="quote-summary">
            <h4>Resumen del envío:</h4>
            <div class="quote-summary-grid">
              <div class="quote-summary-item">
                <span class="label">Servicio:</span>
                <span class="value">{{ quoteData.serviceType }}</span>
              </div>
              <div class="quote-summary-item">
                <span class="label">Peso:</span>
                <span class="value">{{ quoteData.weight }} kg</span>
              </div>
              <div class="quote-summary-item">
                <span class="label">Valor declarado:</span>
                <span class="value">\${{ formatPrice(quoteData.declaredValue) }}</span>
              </div>
              <div class="quote-summary-item">
                <span class="label">Piezas:</span>
                <span class="value">{{ quoteData.pieces || 1 }}</span>
              </div>
              <div class="quote-summary-item" *ngIf="quoteData.dimensions">
                <span class="label">Dimensiones:</span>
                <span class="value">{{ quoteData.dimensions }} cm</span>
              </div>
              <div class="quote-summary-item">
                <span class="label">Seguro:</span>
                <span class="value">{{ quoteData.insurance === 'no' ? 'Sin seguro' : quoteData.insurance }}</span>
              </div>
            </div>
          </div>

          <!-- Info -->
          <div class="quote-info-notice">
            <app-icon category="common" name="info" size="16px"></app-icon>
            <span>Este precio es una estimación. El precio final puede variar según la ruta.</span>
          </div>

          <!-- Acciones -->
          <div class="quote-result-actions">
            <button class="btn btn-secondary" (click)="onReset()">
              <app-icon category="common" name="refresh-cw" size="18px"></app-icon>
              <span>Nueva Cotización</span>
            </button>
            <button class="btn btn-primary" (click)="onProceedToCreate()">
              <app-icon category="common" name="plus-circle" size="18px"></app-icon>
              <span>Crear Guía</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Placeholder cuando no hay cotización -->
      <div class="quote-placeholder" *ngIf="result === null">
        <div class="quote-placeholder-content">
          <app-icon category="common" name="calculator" size="64px"></app-icon>
          <h3>Ingresa los datos de tu envío</h3>
          <p>Completa el formulario para obtener una cotización instantánea</p>
          
          <div class="quote-pricing-info">
            <h4>Tarifas de referencia:</h4>
            <ul>
              <li>
                <app-icon category="common" name="check" size="14px"></app-icon>
                Tarifa base: \$15,000
              </li>
              <li>
                <app-icon category="common" name="check" size="14px"></app-icon>
                Por kilogramo: \$3,000
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>