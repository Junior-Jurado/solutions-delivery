<form [formGroup]="guideForm" (ngSubmit)="onSubmit()" class="guide-form">
  <div class="form-grid">
    <!-- ===== REMITENTE ===== -->
    <div class="form-section">
      <div class="section-header">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        </svg>
        <h3>Información del Remitente</h3>
      </div>

      <div class="form-row">
        <div class="form-field">
          <label for="senderName">Nombre completo *</label>
          <input 
            id="senderName" 
            type="text" 
            formControlName="senderName" 
            placeholder="Juan Pérez">
          <span class="error-message" *ngIf="hasError('senderName')">
            {{ getErrorMessage('senderName') }}
          </span>
        </div>
        <div class="form-field">
          <label for="senderDocType">Tipo de documento *</label>
          <select id="senderDocType" formControlName="senderDocType">
            <option *ngFor="let type of documentTypes" [value]="type">{{ type }}</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-field">
          <label for="senderDoc">Número de documento *</label>
          <input 
            id="senderDoc" 
            type="text" 
            formControlName="senderDoc" 
            placeholder="12345678">
          <span class="error-message" *ngIf="hasError('senderDoc')">
            {{ getErrorMessage('senderDoc') }}
          </span>
        </div>
        <div class="form-field">
          <label for="senderPhone">Teléfono *</label>
          <input 
            id="senderPhone" 
            type="tel" 
            formControlName="senderPhone" 
            placeholder="3001234567">
          <span class="error-message" *ngIf="hasError('senderPhone')">
            {{ getErrorMessage('senderPhone') }}
          </span>
        </div>
        <div class="form-field">
          <label for="senderEmail">Email</label>
          <input 
            id="senderEmail" 
            type="email" 
            formControlName="senderEmail" 
            placeholder="juan@email.com">
        </div>
      </div>

      <div class="form-field">
        <label for="senderAddress">Dirección completa *</label>
        <textarea 
          id="senderAddress" 
          formControlName="senderAddress" 
          placeholder="Calle 123 #45-67, Barrio"></textarea>
        <span class="error-message" *ngIf="hasError('senderAddress')">
          {{ getErrorMessage('senderAddress') }}
        </span>
      </div>

      <div class="form-field">
        <label for="senderCity">Ciudad origen *</label>
        <app-city-selector
          formControlName="senderCity"
          [enableSearch]="true"
          placeholder="Buscar ciudad de origen..."
          (citySelected)="onSenderCitySelected($event)">
        </app-city-selector>
        <span class="error-message" *ngIf="hasError('senderCity')">
          {{ getErrorMessage('senderCity') }}
        </span>
      </div>
    </div>

    <!-- ===== DESTINATARIO ===== -->
    <div class="form-section">
      <div class="section-header destination">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
          <circle cx="12" cy="10" r="3"></circle>
        </svg>
        <h3>Información del Destinatario</h3>
      </div>

      <div class="form-row">
        <div class="form-field">
          <label for="receiverName">Nombre completo *</label>
          <input 
            id="receiverName" 
            type="text" 
            formControlName="receiverName" 
            placeholder="María González">
          <span class="error-message" *ngIf="hasError('receiverName')">
            {{ getErrorMessage('receiverName') }}
          </span>
        </div>
        <div class="form-field">
          <label for="receiverDocType">Tipo de documento *</label>
          <select id="receiverDocType" formControlName="receiverDocType">
            <option *ngFor="let type of documentTypes" [value]="type">{{ type }}</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-field">
          <label for="receiverDoc">Número de documento *</label>
          <input 
            id="receiverDoc" 
            type="text" 
            formControlName="receiverDoc" 
            placeholder="87654321">
          <span class="error-message" *ngIf="hasError('receiverDoc')">
            {{ getErrorMessage('receiverDoc') }}
          </span>
        </div>
        <div class="form-field">
          <label for="receiverPhone">Teléfono *</label>
          <input 
            id="receiverPhone" 
            type="tel" 
            formControlName="receiverPhone" 
            placeholder="3009876543">
          <span class="error-message" *ngIf="hasError('receiverPhone')">
            {{ getErrorMessage('receiverPhone') }}
          </span>
        </div>
        <div class="form-field">
          <label for="receiverEmail">Email</label>
          <input 
            id="receiverEmail" 
            type="email" 
            formControlName="receiverEmail" 
            placeholder="maria@email.com">
        </div>
      </div>

      <div class="form-field">
        <label for="receiverAddress">Dirección completa *</label>
        <textarea 
          id="receiverAddress" 
          formControlName="receiverAddress" 
          placeholder="Carrera 89 #12-34, Barrio"></textarea>
        <span class="error-message" *ngIf="hasError('receiverAddress')">
          {{ getErrorMessage('receiverAddress') }}
        </span>
      </div>

      <div class="form-field">
        <label for="receiverCity">Ciudad destino *</label>
        <app-city-selector
          formControlName="receiverCity"
          [enableSearch]="true"
          placeholder="Buscar ciudad de destino..."
          (citySelected)="onReceiverCitySelected($event)">
        </app-city-selector>
        <span class="error-message" *ngIf="hasError('receiverCity')">
          {{ getErrorMessage('receiverCity') }}
        </span>
      </div>
    </div>
  </div>

  <!-- ===== INFORMACIÓN DEL PAQUETE ===== -->
  <div class="form-section full-width">
    <div class="section-header">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
        <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
        <line x1="12" y1="22.08" x2="12" y2="12"></line>
      </svg>
      <h3>Información del Paquete</h3>
    </div>

    <div class="form-row four-cols">
      <div class="form-field">
        <label for="serviceType">Tipo de servicio *</label>
        <select id="serviceType" formControlName="serviceType">
          <option value="">Seleccionar</option>
          <option *ngFor="let type of serviceTypes" [value]="type">{{ type }}</option>
        </select>
      </div>
      <div class="form-field">
        <label for="weight">Peso (kg) *</label>
        <input 
          id="weight" 
          type="number" 
          step="0.1" 
          formControlName="weight" 
          placeholder="1.5">
      </div>
      <div class="form-field">
        <label for="declaredValue">Valor declarado *</label>
        <input 
          id="declaredValue" 
          type="text" 
          formControlName="declaredValue" 
          placeholder="50000">
      </div>
      <div class="form-field">
        <label for="pieces">Número de piezas</label>
        <input 
          id="pieces" 
          type="number" 
          formControlName="pieces">
      </div>
    </div>

    <div class="form-row three-cols">
      <div class="form-field">
        <label for="dimensions">Dimensiones (cm)</label>
        <input 
          id="dimensions" 
          type="text" 
          formControlName="dimensions" 
          placeholder="20x15x10">
      </div>
      <div class="form-field">
        <label for="priority">Prioridad</label>
        <select id="priority" formControlName="priority">
          <option *ngFor="let priority of priorities" [value]="priority.toLowerCase()">
            {{ priority }}
          </option>
        </select>
      </div>
      <div class="form-field">
        <label for="insurance">Seguro adicional</label>
        <select id="insurance" formControlName="insurance">
          <option *ngFor="let option of insuranceOptions" [value]="option.toLowerCase()">
            {{ option }}
          </option>
        </select>
      </div>
    </div>

    <div class="form-field">
      <label for="content">Descripción del contenido</label>
      <textarea 
        id="content" 
        formControlName="content" 
        placeholder="Descripción detallada del contenido del paquete"></textarea>
    </div>

    <div class="form-field">
      <label for="observations">Observaciones especiales</label>
      <textarea 
        id="observations" 
        formControlName="observations" 
        placeholder="Instrucciones especiales para la entrega"></textarea>
    </div>
  </div>

  <!-- ===== BOTÓN DE ENVÍO ===== -->
  <button 
    type="submit" 
    class="btn btn-primary btn-large" 
    [disabled]="!guideForm.valid || isSubmitting">
    <svg 
      *ngIf="isSubmitting" 
      class="spinner" 
      xmlns="http://www.w3.org/2000/svg" 
      width="20" 
      height="20" 
      viewBox="0 0 24 24" 
      fill="none" 
      stroke="currentColor" 
      stroke-width="2" 
      stroke-linecap="round" 
      stroke-linejoin="round">
      <line x1="12" y1="2" x2="12" y2="6"></line>
      <line x1="12" y1="18" x2="12" y2="22"></line>
      <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
      <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
      <line x1="2" y1="12" x2="6" y2="12"></line>
      <line x1="18" y1="12" x2="22" y2="12"></line>
      <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
      <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
    </svg>
    {{ isSubmitting ? 'Creando guía...' : 'Crear Guía de Envío' }}
  </button>
</form>