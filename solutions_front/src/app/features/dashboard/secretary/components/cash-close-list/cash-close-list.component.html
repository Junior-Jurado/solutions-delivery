<!-- Loading State -->
<div *ngIf="isLoading" class="loading-container">
  <div class="spinner"></div>
  <p>Cargando cierres...</p>
</div>

<!-- Empty State -->
<div *ngIf="!isLoading && closes.length === 0" class="empty-state">
  <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="2" y="5" width="20" height="14" rx="2"></rect>
    <line x1="2" y1="10" x2="22" y2="10"></line>
  </svg>
  <h3>No hay cierres de caja</h3>
  <p>Aún no se han generado cierres de caja. Usa el formulario de arriba para crear uno.</p>
</div>

<!-- Closes List -->
<div *ngIf="!isLoading && closes.length > 0" class="closes-list">
  <div *ngFor="let close of closes" class="close-item">
    <!-- Header -->
    <div class="close-header">
      <div class="close-id-section">
        <div class="close-id">Cierre #{{ close.close_id }}</div>
        <div class="close-period">
          <span class="badge badge-secondary">{{ translatePeriodType(close.period_type) }}</span>
          <span class="close-date">{{ formatDate(close.start_date) }} - {{ formatDate(close.end_date) }}</span>
        </div>
      </div>
      <div class="close-total">
        <div class="total-label">Total</div>
        <div class="total-amount">${{ close.total_amount.toLocaleString() }}</div>
      </div>
    </div>

    <!-- Summary -->
    <div class="close-summary">
      <div class="summary-grid">
        <div class="summary-item">
          <div class="summary-icon cash">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="1" x2="12" y2="23"></line>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
          </div>
          <div class="summary-info">
            <div class="summary-label">Contado</div>
            <div class="summary-value">${{ close.total_cash.toLocaleString() }}</div>
          </div>
        </div>

        <div class="summary-item">
          <div class="summary-icon cod">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
              <polyline points="3.29 7 12 12 20.71 7"></polyline>
              <line x1="12" y1="22" x2="12" y2="12"></line>
            </svg>
          </div>
          <div class="summary-info">
            <div class="summary-label">Contraentrega</div>
            <div class="summary-value">${{ close.total_cod.toLocaleString() }}</div>
          </div>
        </div>

        <div class="summary-item">
          <div class="summary-icon credit">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
              <line x1="1" y1="10" x2="23" y2="10"></line>
            </svg>
          </div>
          <div class="summary-info">
            <div class="summary-label">Crédito</div>
            <div class="summary-value">${{ close.total_credit.toLocaleString() }}</div>
          </div>
        </div>

        <div class="summary-item">
          <div class="summary-icon guides">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
              <polyline points="14 2 14 8 20 8"></polyline>
            </svg>
          </div>
          <div class="summary-info">
            <div class="summary-label">Guías</div>
            <div class="summary-value">{{ close.total_guides }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Details -->
    <div class="close-details">
      <div class="detail-row">
        <span class="detail-label">Unidades:</span>
        <span class="detail-value">{{ close.total_units }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Peso total:</span>
        <span class="detail-value">{{ close.total_weight.toFixed(2) }} kg</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Fletes:</span>
        <span class="detail-value">${{ close.total_freight.toLocaleString() }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Acarreo:</span>
        <span class="detail-value">${{ close.total_handling.toLocaleString() }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Otros:</span>
        <span class="detail-value">${{ close.total_other.toLocaleString() }}</span>
      </div>
      <div class="detail-row">
        <span class="detail-label">Descuentos:</span>
        <span class="detail-value">${{ close.total_discounts.toLocaleString() }}</span>
      </div>
    </div>

    <!-- Footer -->
    <div class="close-footer">
      <div class="close-metadata">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span>Creado: {{ formatDateTime(close.created_at) }}</span>
      </div>
      <button 
        *ngIf="hasPDF(close)" 
        class="btn btn-primary"
        (click)="onDownloadPDF(close.close_id)">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
        Descargar PDF
      </button>
    </div>
  </div>
</div>

<!-- Pagination -->
<div *ngIf="!isLoading && closes.length > 0" class="pagination">
  <button 
    class="btn btn-outline" 
    (click)="onPreviousPage()" 
    [disabled]="currentPage === 0">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="15 18 9 12 15 6"></polyline>
    </svg>
    Anterior
  </button>
  <span class="pagination-info">
    Página {{ currentPage + 1 }} de {{ getTotalPages() }}
  </span>
  <button 
    class="btn btn-outline" 
    (click)="onNextPage()" 
    [disabled]="currentPage >= getTotalPages() - 1">
    Siguiente
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </button>
</div>