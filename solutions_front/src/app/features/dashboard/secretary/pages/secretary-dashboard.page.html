<div class="dashboard-container">
  <!-- ========================================
       HEADER
       ======================================== -->
  <app-dashboard-header
    userRole="Secretari@"
    userDescription="Panel de gestión"
    [userName]="userName"
    [showUserName]="true"
    (logout)="handleLogout()">
  </app-dashboard-header>

  <!-- ========================================
       MAIN PANEL
       ======================================== -->
  <div class="secretary-panel">
    <!-- Tabs Navigation -->
    <nav class="tabs-navigation">
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'create-guide'"
        (click)="setActiveTab('create-guide')">
        <app-icon category="common" name="plus" size="20px"></app-icon>
        <span>Nueva Guía</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'manage-guides'"
        (click)="setActiveTab('manage-guides')">
        <app-icon category="common" name="file-text" size="20px"></app-icon>
        <span>Gestionar Guías</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'search'"
        (click)="setActiveTab('search')">
        <app-icon category="common" name="search" size="20px"></app-icon>
        <span>Buscar/Rastrear</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'reports'"
        (click)="setActiveTab('reports')">
        <app-icon category="common" name="bar-chart" size="20px"></app-icon>
        <span>Reportes</span>
      </button>

      <button
        class="tab-button"
        [class.active]="activeTab === 'assignments'"
        (click)="setActiveTab('assignments')">
        <app-icon category="common" name="users" size="20px"></app-icon>
        <span>Asignar Repartidores</span>
      </button>

      <button
        class="tab-button"
        [class.active]="activeTab === 'cash-close'"
        (click)="setActiveTab('cash-close')">
        <app-icon category="common" name="credit-card" size="20px"></app-icon>
        <span>Cierre de Caja</span>
      </button>
    </nav>

    <!-- ========================================
         TAB 1: CREATE GUIDE
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'create-guide'">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="common" name="box" size="20px" color="#3b82f6"></app-icon>
            Nueva Guía de Envío
          </h2>
          <p class="card-description">Crear una nueva guía para envío de paquetes</p>
        </div>
        <div class="card-content">
          <app-guide-form 
            [currentUserId]="currentUserId"
            (formSubmit)="handleGuideFormSubmit($event)">
          </app-guide-form>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 2: MANAGE GUIDES
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'manage-guides'">
      <!-- Filters Card -->
      <div class="card mb-6">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="common" name="filter" size="20px" color="#3b82f6"></app-icon>
            Filtros de Búsqueda
          </h2>
        </div>
        <div class="card-content">
          <app-guide-filters
            [cities]="filterCities"
            [isLoading]="isLoadingGuides"
            (filterApplied)="handleFiltersApplied($event)"
            (filterCleared)="handleFiltersClear()">
          </app-guide-filters>
        </div>
      </div>

      <!-- Guides List Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Gestión de Guías</h2>
          <p class="card-description">
            Mostrando {{ guides.length }} de {{ totalGuides }} guías
          </p>
        </div>
        <div class="card-content">
          <app-guide-list
            [guides]="guides"
            [isLoading]="isLoadingGuides"
            [totalGuides]="totalGuides"
            [currentPage]="currentPage"
            [pageSize]="pageSize"
            (statusUpdate)="handleStatusUpdate($event)"
            (viewDetails)="viewDetails($event)"
            (downloadPDF)="downloadGuidePDF($event)"
            (pageChange)="handlePageChange($event)">
          </app-guide-list>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 3: SEARCH
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'search'">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="common" name="search" size="20px" color="#3b82f6"></app-icon>
            Buscar y Rastrear Envíos
          </h2>
          <p class="card-description">Busca guías por número, cliente o ciudad</p>
        </div>
        <div class="card-content">
          <app-guide-search
            [searchResults]="searchResults"
            [isSearching]="isSearching"
            (search)="handleSearch($event)"
            (viewDetails)="viewDetails($event)"
            (downloadPDF)="downloadGuidePDF($event)">
          </app-guide-search>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 4: REPORTS
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'reports'">
      <!-- Stats Cards -->
      <app-stats-cards
        [isLoading]="isLoadingStats"
        [totalToday]="stats?.total_today || 0"
        [totalProcessed]="stats?.total_processed || 0"
        [totalPending]="stats?.total_pending || 0">
      </app-stats-cards>

      <!-- Status Distribution Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="common" name="bar-chart" size="20px" color="#3b82f6"></app-icon>
            Distribución por Estado
          </h2>
          <p class="card-description">Cantidad de guías en cada estado</p>
        </div>
        <div class="card-content">
          <app-status-distribution
            [statusCounts]="stats?.by_status || {}"
            [isLoading]="isLoadingStats">
          </app-status-distribution>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 5: ASSIGNMENTS
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'assignments'">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="common" name="users" size="20px" color="#3b82f6"></app-icon>
            Asignacion de Repartidores
          </h2>
          <p class="card-description">Asigna repartidores para recoger y entregar paquetes en Bogota</p>
        </div>
        <div class="card-content">
          <app-assignment-panel
            (assignmentCreated)="loadGuides()">
          </app-assignment-panel>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 6: CASH CLOSE
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'cash-close'">
      <!-- Cash Close Stats -->
      <app-cash-close-stats
        [stats]="cashCloseStats"
        [isLoading]="isLoadingCloseStats">
      </app-cash-close-stats>

      <!-- Cash Close Form Card -->
      <div class="card mb-6">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="common" name="credit-card" size="20px" color="#3b82f6"></app-icon>
            Generar Nuevo Cierre de Caja
          </h2>
          <p class="card-description">Selecciona el tipo de período y las fechas para generar un cierre</p>
        </div>
        <div class="card-content">
          <app-cash-close-form
            [isGenerating]="isGeneratingClose"
            (generateClose)="handleCashCloseGenerate($event)">
          </app-cash-close-form>
        </div>
      </div>

      <!-- Cash Close List Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Historial de Cierres de Caja</h2>
          <p class="card-description">
            <ng-container *ngIf="cashCloses && cashCloses.length > 0; else noCierres">
              Mostrando {{ cashCloses.length }} de {{ totalCloses }} cierres
            </ng-container>
            <ng-template #noCierres>
              No hay cierres de caja registrados
            </ng-template>
          </p>
        </div>
        <div class="card-content">
          <app-cash-close-list
            [closes]="cashCloses"
            [isLoading]="isLoadingCloses"
            [totalCloses]="totalCloses"
            [currentPage]="currentClosePage"
            [pageSize]="closePageSize"
            (downloadPDF)="downloadClosePDF($event)"
            (pageChange)="handleClosePageChange($event)">
          </app-cash-close-list>
        </div>
      </div>
    </div>
  </div>

  <!-- ========================================
       MODAL: GUIDE PREVIEW (CONFIRMACIÓN)
       ======================================== -->
  <app-guide-preview-modal
    [isOpen]="showGuidePreview"
    [guideData]="guidePreviewData"
    [isCreating]="isCreatingGuide"
    title="Confirmar Creación de Guía"
    warningMessage="Verifique toda la información antes de confirmar la creación de la guía."
    (confirm)="confirmGuideCreation()"
    (cancel)="cancelGuideCreation()"
    (closeModal)="cancelGuideCreation()">
  </app-guide-preview-modal>

  <!-- ========================================
       MODAL: GUIDE DETAILS
       ======================================== -->
  <app-guide-details-modal
    [guide]="selectedGuideForDetails"
    [isOpen]="isDetailsModalOpen"
    (closeModal)="closeDetailsModal()"
    (downloadPDFEvent)="downloadPDFFromModal($event)">
  </app-guide-details-modal>
</div>