<div class="dashboard-container">
  <!-- ========================================
       HEADER
       ======================================== -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <div class="logo-container">
          <div class="logo-circle">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
              <polyline points="3.29 7 12 12 20.71 7"></polyline>
              <line x1="12" y1="22" x2="12" y2="12"></line>
            </svg>
          </div>
          <span class="logo-text">SOLUCIONES</span>
        </div>
      </div>
      
      <div class="header-right">
        <div class="user-info">
          <div class="user-avatar">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          </div>
          <div class="user-details">
            <div class="user-role">Secretari@</div>
            <div class="user-description">Panel de gestión</div>
          </div>
        </div>
        <button class="btn-logout" (click)="handleLogout()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
          </svg>
          <span class="logout-text">Cerrar Sesión</span>
        </button>
      </div>
    </div>
  </header>

  <!-- ========================================
       MAIN PANEL
       ======================================== -->
  <div class="secretary-panel">
    <!-- Tabs Navigation -->
    <nav class="tabs-navigation">
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'create-guide'"
        (click)="setActiveTab('create-guide')">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        <span>Nueva Guía</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'manage-guides'"
        (click)="setActiveTab('manage-guides')">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
        </svg>
        <span>Gestionar Guías</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'search'"
        (click)="setActiveTab('search')">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.35-4.35"></path>
        </svg>
        <span>Buscar/Rastrear</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'reports'"
        (click)="setActiveTab('reports')">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="20" x2="12" y2="10"></line>
          <line x1="18" y1="20" x2="18" y2="4"></line>
          <line x1="6" y1="20" x2="6" y2="16"></line>
        </svg>
        <span>Reportes</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'cash-close'"
        (click)="setActiveTab('cash-close')">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="5" width="20" height="14" rx="2"></rect>
          <line x1="2" y1="10" x2="22" y2="10"></line>
        </svg>
        <span>Cierre de Caja</span>
      </button>
    </nav>

    <!-- ========================================
         TAB 1: CREATE GUIDE
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'create-guide'">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 16h6M16 8h6M16 12h6M2 6h12v12H2z"></path>
            </svg>
            Nueva Guía de Envío
          </h2>
          <p class="card-description">Crear una nueva guía para envío de paquetes</p>
        </div>
        <div class="card-content">
          <app-guide-form 
            [currentUserId]="currentUserId"
            (formSubmit)="handleGuideFormSubmit($event)">
          </app-guide-form>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 2: MANAGE GUIDES
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'manage-guides'">
      <!-- Filters Card -->
      <div class="card mb-6">
        <div class="card-header">
          <h2 class="card-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
            </svg>
            Filtros de Búsqueda
          </h2>
        </div>
        <div class="card-content">
          <app-guide-filters
            [cities]="filterCities"
            [isLoading]="isLoadingGuides"
            (filterApplied)="handleFiltersApplied($event)"
            (filterCleared)="handleFiltersClear()">
          </app-guide-filters>
        </div>
      </div>

      <!-- Guides List Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Gestión de Guías</h2>
          <p class="card-description">
            Mostrando {{ guides.length }} de {{ totalGuides }} guías
          </p>
        </div>
        <div class="card-content">
          <app-guide-list
            [guides]="guides"
            [isLoading]="isLoadingGuides"
            [totalGuides]="totalGuides"
            [currentPage]="currentPage"
            [pageSize]="pageSize"
            (statusUpdate)="handleStatusUpdate($event)"
            (viewDetails)="viewDetails($event)"
            (downloadPDF)="downloadGuidePDF($event)"
            (pageChange)="handlePageChange($event)">
          </app-guide-list>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 3: SEARCH
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'search'">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
            Buscar y Rastrear Envíos
          </h2>
          <p class="card-description">Busca guías por número, cliente o ciudad</p>
        </div>
        <div class="card-content">
          <app-guide-search
            [searchResults]="searchResults"
            [isSearching]="isSearching"
            (search)="handleSearch($event)"
            (viewDetails)="viewDetails($event)"
            (downloadPDF)="downloadGuidePDF($event)">
          </app-guide-search>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 4: REPORTS
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'reports'">
      <!-- Stats Cards -->
      <app-stats-cards
        [isLoading]="isLoadingStats"
        [totalToday]="stats?.total_today || 0"
        [totalProcessed]="stats?.total_processed || 0"
        [totalPending]="stats?.total_pending || 0">
      </app-stats-cards>

      <!-- Status Distribution Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="20" x2="12" y2="10"></line>
              <line x1="18" y1="20" x2="18" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="16"></line>
            </svg>
            Distribución por Estado
          </h2>
          <p class="card-description">Cantidad de guías en cada estado</p>
        </div>
        <div class="card-content">
          <app-status-distribution
            [statusCounts]="stats?.by_status || {}"
            [isLoading]="isLoadingStats">
          </app-status-distribution>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 5: CASH CLOSE
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'cash-close'">
      <!-- Cash Close Stats -->
      <app-cash-close-stats
        [stats]="cashCloseStats"
        [isLoading]="isLoadingCloseStats">
      </app-cash-close-stats>

      <!-- Cash Close Form Card -->
      <div class="card mb-6">
        <div class="card-header">
          <h2 class="card-title">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="2" y="5" width="20" height="14" rx="2"></rect>
              <line x1="2" y1="10" x2="22" y2="10"></line>
            </svg>
            Generar Nuevo Cierre de Caja
          </h2>
          <p class="card-description">Selecciona el tipo de período y las fechas para generar un cierre</p>
        </div>
        <div class="card-content">
          <app-cash-close-form
            [isGenerating]="isGeneratingClose"
            (generateClose)="handleCashCloseGenerate($event)">
          </app-cash-close-form>
        </div>
      </div>

      <!-- Cash Close List Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Historial de Cierres de Caja</h2>
          <p class="card-description">
            Mostrando {{ cashCloses.length }} de {{ totalCloses }} cierres
          </p>
        </div>
        <div class="card-content">
          <app-cash-close-list
            [closes]="cashCloses"
            [isLoading]="isLoadingCloses"
            [totalCloses]="totalCloses"
            [currentPage]="currentClosePage"
            [pageSize]="closePageSize"
            (downloadPDF)="downloadClosePDF($event)"
            (pageChange)="handleClosePageChange($event)">
          </app-cash-close-list>
        </div>
      </div>
    </div>
  </div>

  <!-- ========================================
       MODAL GLOBAL
       ======================================== -->
  <app-guide-details-modal
    [guide]="selectedGuideForDetails"
    [isOpen]="isDetailsModalOpen"
    (closeModal)="closeDetailsModal()"
    (downloadPDFEvent)="downloadPDFFromModal($event)">
  </app-guide-details-modal>
</div>