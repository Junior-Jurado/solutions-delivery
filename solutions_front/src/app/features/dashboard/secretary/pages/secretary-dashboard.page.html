<div class="dashboard-container">
  <!-- ========================================
       HEADER
       ======================================== -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="header-left">
        <div class="logo-container">
          <div class="logo-circle">
            <app-icon category="common" name="package" size="24px" color="#ffffff"></app-icon>
          </div>
          <span class="logo-text">SOLUCIONES</span>
        </div>
      </div>
      
      <div class="header-right">
        <div class="user-info">
          <div class="user-avatar">
            <app-icon category="common" name="user" size="20px" color="#ffffff"></app-icon>
          </div>
          <div class="user-details">
            <div class="user-role">Secretari@</div>
            <div class="user-description">Panel de gestión</div>
          </div>
        </div>
        <button class="btn-logout" (click)="handleLogout()">
          <app-icon category="common" name="log-out" size="18px"></app-icon>
          <span class="logout-text">Cerrar Sesión</span>
        </button>
      </div>
    </div>
  </header>

  <!-- ========================================
       MAIN PANEL
       ======================================== -->
  <div class="secretary-panel">
    <!-- Tabs Navigation -->
    <nav class="tabs-navigation">
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'create-guide'"
        (click)="setActiveTab('create-guide')">
        <app-icon category="common" name="plus" size="20px"></app-icon>
        <span>Nueva Guía</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'manage-guides'"
        (click)="setActiveTab('manage-guides')">
        <app-icon category="common" name="file-text" size="20px"></app-icon>
        <span>Gestionar Guías</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'search'"
        (click)="setActiveTab('search')">
        <app-icon category="common" name="search" size="20px"></app-icon>
        <span>Buscar/Rastrear</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'reports'"
        (click)="setActiveTab('reports')">
        <app-icon category="common" name="bar-chart" size="20px"></app-icon>
        <span>Reportes</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'cash-close'"
        (click)="setActiveTab('cash-close')">
        <app-icon category="common" name="credit-card" size="20px"></app-icon>
        <span>Cierre de Caja</span>
      </button>
    </nav>

    <!-- ========================================
         TAB 1: CREATE GUIDE
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'create-guide'">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="common" name="box" size="20px" color="#3b82f6"></app-icon>
            Nueva Guía de Envío
          </h2>
          <p class="card-description">Crear una nueva guía para envío de paquetes</p>
        </div>
        <div class="card-content">
          <app-guide-form 
            [currentUserId]="currentUserId"
            (formSubmit)="handleGuideFormSubmit($event)">
          </app-guide-form>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 2: MANAGE GUIDES
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'manage-guides'">
      <!-- Filters Card -->
      <div class="card mb-6">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="common" name="filter" size="20px" color="#3b82f6"></app-icon>
            Filtros de Búsqueda
          </h2>
        </div>
        <div class="card-content">
          <app-guide-filters
            [cities]="filterCities"
            [isLoading]="isLoadingGuides"
            (filterApplied)="handleFiltersApplied($event)"
            (filterCleared)="handleFiltersClear()">
          </app-guide-filters>
        </div>
      </div>

      <!-- Guides List Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Gestión de Guías</h2>
          <p class="card-description">
            Mostrando {{ guides.length }} de {{ totalGuides }} guías
          </p>
        </div>
        <div class="card-content">
          <app-guide-list
            [guides]="guides"
            [isLoading]="isLoadingGuides"
            [totalGuides]="totalGuides"
            [currentPage]="currentPage"
            [pageSize]="pageSize"
            (statusUpdate)="handleStatusUpdate($event)"
            (viewDetails)="viewDetails($event)"
            (downloadPDF)="downloadGuidePDF($event)"
            (pageChange)="handlePageChange($event)">
          </app-guide-list>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 3: SEARCH
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'search'">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="common" name="search" size="20px" color="#3b82f6"></app-icon>
            Buscar y Rastrear Envíos
          </h2>
          <p class="card-description">Busca guías por número, cliente o ciudad</p>
        </div>
        <div class="card-content">
          <app-guide-search
            [searchResults]="searchResults"
            [isSearching]="isSearching"
            (search)="handleSearch($event)"
            (viewDetails)="viewDetails($event)"
            (downloadPDF)="downloadGuidePDF($event)">
          </app-guide-search>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 4: REPORTS
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'reports'">
      <!-- Stats Cards -->
      <app-stats-cards
        [isLoading]="isLoadingStats"
        [totalToday]="stats?.total_today || 0"
        [totalProcessed]="stats?.total_processed || 0"
        [totalPending]="stats?.total_pending || 0">
      </app-stats-cards>

      <!-- Status Distribution Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="common" name="bar-chart" size="20px" color="#3b82f6"></app-icon>
            Distribución por Estado
          </h2>
          <p class="card-description">Cantidad de guías en cada estado</p>
        </div>
        <div class="card-content">
          <app-status-distribution
            [statusCounts]="stats?.by_status || {}"
            [isLoading]="isLoadingStats">
          </app-status-distribution>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 5: CASH CLOSE
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'cash-close'">
      <!-- Cash Close Stats -->
      <app-cash-close-stats
        [stats]="cashCloseStats"
        [isLoading]="isLoadingCloseStats">
      </app-cash-close-stats>

      <!-- Cash Close Form Card -->
      <div class="card mb-6">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="common" name="credit-card" size="20px" color="#3b82f6"></app-icon>
            Generar Nuevo Cierre de Caja
          </h2>
          <p class="card-description">Selecciona el tipo de período y las fechas para generar un cierre</p>
        </div>
        <div class="card-content">
          <app-cash-close-form
            [isGenerating]="isGeneratingClose"
            (generateClose)="handleCashCloseGenerate($event)">
          </app-cash-close-form>
        </div>
      </div>

      <!-- Cash Close List Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Historial de Cierres de Caja</h2>
          <p class="card-description">
            Mostrando {{ cashCloses.length }} de {{ totalCloses }} cierres
          </p>
        </div>
        <div class="card-content">
          <app-cash-close-list
            [closes]="cashCloses"
            [isLoading]="isLoadingCloses"
            [totalCloses]="totalCloses"
            [currentPage]="currentClosePage"
            [pageSize]="closePageSize"
            (downloadPDF)="downloadClosePDF($event)"
            (pageChange)="handleClosePageChange($event)">
          </app-cash-close-list>
        </div>
      </div>
    </div>
  </div>

  <!-- ========================================
       MODAL GLOBAL
       ======================================== -->
  <app-guide-details-modal
    [guide]="selectedGuideForDetails"
    [isOpen]="isDetailsModalOpen"
    (closeModal)="closeDetailsModal()"
    (downloadPDFEvent)="downloadPDFFromModal($event)">
  </app-guide-details-modal>
</div>