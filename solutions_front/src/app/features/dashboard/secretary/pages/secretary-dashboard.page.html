<div class="dashboard-container">
  <!-- ========================================
       HEADER
       ======================================== -->
  <app-dashboard-header
    userRole="Secretari@"
    userDescription="Panel de gestión"
    [userName]="userName"
    [showUserName]="true"
    (logout)="handleLogout()">
  </app-dashboard-header>

  <!-- ========================================
       MAIN PANEL
       ======================================== -->
  <div class="secretary-panel">
    <!-- Tabs Navigation -->
    <nav class="tabs-navigation">
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'create-guide'"
        (click)="setActiveTab('create-guide')">
        <app-icon category="actions" name="plus" size="20px"></app-icon>
        <span>Nueva Guía</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'manage-guides'"
        (click)="setActiveTab('manage-guides')">
        <app-icon category="documents" name="file-text" size="20px"></app-icon>
        <span>Gestionar Guías</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'search'"
        (click)="setActiveTab('search')">
        <app-icon category="navigation" name="search" size="20px"></app-icon>
        <span>Buscar/Rastrear</span>
      </button>

      <button 
        class="tab-button" 
        [class.active]="activeTab === 'reports'"
        (click)="setActiveTab('reports')">
        <app-icon category="stats" name="bar-chart" size="20px"></app-icon>
        <span>Reportes</span>
      </button>

      <button
        class="tab-button"
        [class.active]="activeTab === 'assignments'"
        (click)="setActiveTab('assignments')">
        <app-icon category="users" name="users" size="20px"></app-icon>
        <span>Asignar Repartidores</span>
      </button>

    </nav>

    <!-- ========================================
         TAB 1: CREATE GUIDE
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'create-guide'">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="delivery" name="box" size="20px" color="#3b82f6"></app-icon>
            Nueva Guía de Envío
          </h2>
          <p class="card-description">Crear una nueva guía para envío de paquetes</p>
        </div>
        <div class="card-content">
          <app-guide-form 
            [currentUserId]="currentUserId"
            (formSubmit)="handleGuideFormSubmit($event)">
          </app-guide-form>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 2: MANAGE GUIDES
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'manage-guides'">
      <!-- Filters Card -->
      <div class="card mb-6">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="navigation" name="filter" size="20px" color="#3b82f6"></app-icon>
            Filtros de Búsqueda
          </h2>
        </div>
        <div class="card-content">
          <app-guide-filters
            [cities]="filterCities"
            [isLoading]="isLoadingGuides"
            (filterApplied)="handleFiltersApplied($event)"
            (filterCleared)="handleFiltersClear()">
          </app-guide-filters>
        </div>
      </div>

      <!-- Guides List Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Gestión de Guías</h2>
          <p class="card-description">
            Mostrando {{ guides.length }} de {{ totalGuides }} guías
          </p>
        </div>
        <div class="card-content">
          <app-guide-list
            [guides]="guides"
            [isLoading]="isLoadingGuides"
            [totalGuides]="totalGuides"
            [currentPage]="currentPage"
            [pageSize]="pageSize"
            (statusUpdate)="handleStatusUpdate($event)"
            (viewDetails)="viewDetails($event)"
            (downloadPDF)="downloadGuidePDF($event)"
            (pageChange)="handlePageChange($event)">
          </app-guide-list>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 3: SEARCH
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'search'">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="navigation" name="search" size="20px" color="#3b82f6"></app-icon>
            Buscar y Rastrear Envíos
          </h2>
          <p class="card-description">Busca guías por número, cliente o ciudad</p>
        </div>
        <div class="card-content">
          <app-guide-search
            [searchResults]="searchResults"
            [isSearching]="isSearching"
            (searchGuide)="handleSearch($event)"
            (viewDetails)="viewDetails($event)"
            (downloadPDF)="downloadGuidePDF($event)">
          </app-guide-search>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 4: REPORTS
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'reports'">
      <!-- Stats Cards -->
      <app-stats-cards
        [isLoading]="isLoadingStats"
        [totalToday]="stats?.total_today || 0"
        [totalProcessed]="stats?.total_processed || 0"
        [totalPending]="stats?.total_pending || 0">
      </app-stats-cards>

      <!-- Status Distribution Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="stats" name="bar-chart" size="20px" color="#3b82f6"></app-icon>
            Distribución por Estado
          </h2>
          <p class="card-description">Cantidad de guías en cada estado</p>
        </div>
        <div class="card-content">
          <app-status-distribution
            [statusCounts]="stats?.by_status || {}"
            [isLoading]="isLoadingStats">
          </app-status-distribution>
        </div>
      </div>
    </div>

    <!-- ========================================
         TAB 5: ASSIGNMENTS
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'assignments'">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <app-icon category="users" name="users" size="20px" color="#3b82f6"></app-icon>
            Asignacion de Repartidores
          </h2>
          <p class="card-description">Asigna repartidores para recoger y entregar paquetes en Bogota</p>
        </div>
        <div class="card-content">
          <app-assignment-panel
            (assignmentCreated)="loadGuides()">
          </app-assignment-panel>
        </div>
      </div>
    </div>

  </div>

  <!-- ========================================
       MODAL: GUIDE PREVIEW (CONFIRMACIÓN)
       ======================================== -->
  <app-guide-preview-modal
    [isOpen]="showGuidePreview"
    [guideData]="guidePreviewData"
    [isCreating]="isCreatingGuide"
    [allowPriceEdit]="false"
    title="Confirmar Creación de Guía"
    warningMessage="Verifique toda la información antes de confirmar la creación de la guía."
    (confirmAction)="confirmGuideCreation($event)"
    (cancelAction)="cancelGuideCreation()"
    (closeModal)="cancelGuideCreation()">
  </app-guide-preview-modal>

  <!-- ========================================
       MODAL: GUIDE DETAILS
       ======================================== -->
  <app-guide-details-modal
    [guide]="selectedGuideForDetails"
    [isOpen]="isDetailsModalOpen"
    (closeModal)="closeDetailsModal()"
    (downloadPDFEvent)="downloadPDFFromModal($event)">
  </app-guide-details-modal>

  <!-- Floating Refresh Button -->
  <button
    class="floating-refresh-btn"
    [class.refreshing]="isRefreshing"
    [disabled]="isRefreshing"
    (click)="handleRefresh()"
    title="Actualizar datos">
    <app-icon
      category="navigation"
      name="refresh-cw"
      size="24px"
      [class.spin]="isRefreshing">
    </app-icon>
  </button>
</div>