<div class="delivery-container">
  <!-- ========================================
       HEADER
       ======================================== -->
  <app-dashboard-header
    userRole="Repartidor"
    userDescription="Panel de entregas"
    [userName]="userName"
    [showUserName]="true"
    [isMobile]="isMobile"
    (logout)="logout()">
  </app-dashboard-header>

  <!-- ========================================
       MAIN PANEL
       ======================================== -->
  <div class="delivery-panel">
    <!-- Tabs Navigation -->
    <nav class="tabs-navigation">
      <button
        class="tab-button"
        [class.active]="activeTab === 'deliveries'"
        (click)="setActiveTab('deliveries')">
        <app-icon category="common" name="package" size="20px"></app-icon>
        <span>Mis Entregas</span>
      </button>

      <button
        class="tab-button"
        [class.active]="activeTab === 'confirm'"
        (click)="setActiveTab('confirm')">
        <app-icon category="common" name="check-circle" size="20px"></app-icon>
        <span>Confirmar Entrega</span>
      </button>

      <button
        class="tab-button"
        [class.active]="activeTab === 'issues'"
        (click)="setActiveTab('issues')">
        <app-icon category="common" name="alert-triangle" size="20px"></app-icon>
        <span>Reportar Problema</span>
      </button>

      <button
        class="tab-button"
        [class.active]="activeTab === 'performance'"
        (click)="setActiveTab('performance')">
        <app-icon category="common" name="star" size="20px"></app-icon>
        <span>Mi Rendimiento</span>
      </button>
    </nav>

    <!-- ========================================
         TAB 1: DELIVERIES
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'deliveries'">
      <div class="content-wrapper">
        <!-- Stats Cards -->
        <app-delivery-stats
          [stats]="stats"
          [isLoading]="isLoadingDeliveries">
        </app-delivery-stats>

        <!-- Assignments List -->
        <app-assignments-list
          [pickups]="pickups"
          [deliveries]="deliveries"
          [isLoading]="isLoadingDeliveries"
          (startRoute)="handleStartRoute($event)"
          (confirmDelivery)="handleConfirmDelivery($event)"
          (viewOnMap)="handleViewOnMap($event)"
          (callRecipient)="handleCallRecipient($event)">
        </app-assignments-list>
      </div>
    </div>

    <!-- ========================================
         TAB 2: CONFIRM DELIVERY
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'confirm'">
      <div class="content-wrapper">
        <app-confirm-delivery-form
          [assignmentsInProgress]="assignmentsInProgress"
          [selectedAssignmentId]="selectedAssignmentId"
          [isConfirming]="isConfirming"
          (assignmentSelected)="onAssignmentSelected($event)"
          (confirm)="handleConfirmSubmit($event)">
        </app-confirm-delivery-form>
      </div>
    </div>

    <!-- ========================================
         TAB 3: REPORT ISSUE
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'issues'">
      <div class="content-wrapper">
        <app-report-issue-form
          [pendingPickups]="pendingPickups"
          [pendingDeliveries]="pendingDeliveries"
          [isReporting]="isReporting"
          (report)="handleReportSubmit($event)">
        </app-report-issue-form>
      </div>
    </div>

    <!-- ========================================
         TAB 4: PERFORMANCE
         ======================================== -->
    <div class="tab-content" *ngIf="activeTab === 'performance'">
      <div class="content-wrapper">
        <app-performance-panel
          [performanceStats]="performanceStats"
          [isLoading]="isLoadingPerformance">
        </app-performance-panel>
      </div>
    </div>
  </div>
</div>

<!-- Map Modal -->
<app-map-modal
  [isOpen]="isMapModalOpen"
  [location]="selectedMapLocation"
  [isMobile]="isMobile"
  (closeModal)="closeMapModal()">
</app-map-modal>
