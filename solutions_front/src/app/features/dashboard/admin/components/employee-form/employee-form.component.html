<!-- Search Section -->
<div class="search-section">
  <div class="search-header">
    <app-icon category="navigation" name="search" size="20px" color="#3b82f6"></app-icon>
    <span>Buscar Usuario por Documento</span>
  </div>

  <div class="search-form">
    <div class="search-input-wrapper">
      <input
        type="text"
        [(ngModel)]="documentNumber"
        placeholder="Ingrese número de documento..."
        (keyup.enter)="searchUser()"
        [disabled]="isSearching">
      <button
        *ngIf="documentNumber"
        class="clear-btn"
        (click)="clearSearch()"
        type="button">
        <app-icon category="navigation" name="x" size="16px"></app-icon>
      </button>
    </div>
    <button
      class="search-btn"
      (click)="searchUser()"
      [disabled]="isSearching || !documentNumber">
      <app-icon
        *ngIf="isSearching"
        category="status"
        name="loader"
        size="18px"
        customClass="spin">
      </app-icon>
      <app-icon
        *ngIf="!isSearching"
        category="navigation"
        name="search"
        size="18px">
      </app-icon>
      <span>{{ isSearching ? 'Buscando...' : 'Buscar' }}</span>
    </button>
  </div>

  <!-- Error Message -->
  <div *ngIf="searchError" class="search-error">
    <app-icon category="status" name="alert-triangle" size="16px"></app-icon>
    <span>{{ searchError }}</span>
  </div>
</div>

<!-- User Found Card -->
<div *ngIf="foundUser" class="user-card">
  <div class="user-card-header">
    <div class="user-avatar">
      <app-icon category="users" name="user" size="24px" color="#ffffff"></app-icon>
    </div>
    <div class="user-main-info">
      <h3 class="user-name">{{ foundUser.full_name || 'Sin nombre' }}</h3>
      <p class="user-email">{{ foundUser.email }}</p>
    </div>
    <div class="user-badges">
      <span class="badge" [ngClass]="getRoleBadgeClass(foundUser.role)">
        {{ getRoleLabel(foundUser.role) }}
      </span>
      <span class="badge" [ngClass]="getStatusBadgeClass(foundUser.status)">
        {{ foundUser.status }}
      </span>
    </div>
  </div>

  <div class="user-details">
    <div class="detail-row">
      <div class="detail-item">
        <span class="detail-label">Documento</span>
        <span class="detail-value">{{ foundUser.type_document || 'CC' }} {{ foundUser.number_document }}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Teléfono</span>
        <span class="detail-value">{{ foundUser.phone || 'No registrado' }}</span>
      </div>
    </div>
    <div class="detail-row">
      <div class="detail-item">
        <span class="detail-label">Fecha de registro</span>
        <span class="detail-value">{{ formatDate(foundUser.created_at) }}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Último acceso</span>
        <span class="detail-value">{{ foundUser.last_login ? formatDate(foundUser.last_login) : 'Nunca' }}</span>
      </div>
    </div>
    <div class="detail-row" *ngIf="foundUser.role === 'DELIVERY'">
      <div class="detail-item">
        <span class="detail-label">Entregas completadas</span>
        <span class="detail-value highlight">{{ foundUser.total_completed || 0 }}</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Rendimiento</span>
        <span class="detail-value">{{ foundUser.performance || 'N/A' }}</span>
      </div>
    </div>
  </div>

  <!-- Role Edit Section -->
  <div class="role-edit-section" *ngIf="canEditRole">
    <div class="role-edit-header">
      <app-icon category="actions" name="edit" size="18px" color="#3b82f6"></app-icon>
      <span>Cambiar Rol del Usuario</span>
    </div>
    <div class="role-edit-form">
      <select [(ngModel)]="selectedRole" class="role-select">
        <option value="" disabled>Seleccionar nuevo rol</option>
        <option *ngFor="let role of roles" [value]="role.value">
          {{ role.label }}
        </option>
      </select>
      <button
        class="update-btn"
        [disabled]="!roleChanged || isUpdating"
        (click)="updateUserRole()">
        <app-icon
          category="status"
          [name]="isUpdating ? 'loader' : 'check'"
          size="18px"
          [class.spin]="isUpdating">
        </app-icon>
        <span>{{ isUpdating ? 'Actualizando...' : 'Actualizar Rol' }}</span>
      </button>
    </div>
  </div>

  <!-- Admin Warning -->
  <div class="admin-warning" *ngIf="foundUser.role === 'ADMIN'">
    <app-icon category="misc" name="shield" size="18px"></app-icon>
    <span>Este usuario es Administrador. No se puede modificar su rol.</span>
  </div>
</div>

<!-- Empty State -->
<div *ngIf="!foundUser && !searchError && !isSearching" class="empty-state">
  <app-icon category="users" name="users" size="48px" color="#d1d5db"></app-icon>
  <p>Ingrese un número de documento para buscar un usuario y gestionar su rol</p>
</div>
